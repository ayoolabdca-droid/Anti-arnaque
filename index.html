<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Anti-arnaque t√©l√©phone (TEST)</title>

  <style>
    :root{
      --bg0:#060913;
      --bg1:#0b1220;
      --glass: rgba(255,255,255,.07);
      --glass2: rgba(255,255,255,.10);
      --border: rgba(255,255,255,.12);

      --text:#e9eefc;
      --muted: rgba(233,238,252,.72);

      --primary:#ff4d6d;
      --primary2:#ff2e55;
      --accent:#ffb703;

      --good:#22c55e;
      --mid:#f59e0b;
      --bad:#ef4444;

      --shadow: 0 18px 50px rgba(0,0,0,.35);
      --shadowSoft: 0 12px 30px rgba(0,0,0,.22);

      --r16:16px;
      --r18:18px;
      --r22:22px;

      --max: 1020px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      background:
        radial-gradient(1100px 600px at 14% 0%, rgba(255,77,109,.25), transparent 60%),
        radial-gradient(900px 600px at 100% 35%, rgba(255,183,3,.18), transparent 55%),
        radial-gradient(800px 500px at 30% 100%, rgba(34,197,94,.10), transparent 55%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
    }

    .wrap{
      max-width: var(--max);
      margin: 0 auto;
      padding: 18px 14px 70px;
    }

    a{color:inherit}

    .muted{color:var(--muted); line-height:1.45}
    .tiny{font-size:12px;color:rgba(233,238,252,.62);line-height:1.45}

    /* Top Nav */
    .nav{
      position: sticky;
      top: 0;
      z-index: 50;
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      background: linear-gradient(180deg, rgba(6,9,19,.78), rgba(6,9,19,.42));
      border-bottom: 1px solid rgba(255,255,255,.10);
    }
    .navInner{
      max-width: var(--max);
      margin:0 auto;
      padding: 10px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      min-width: 240px;
    }
    .brand img{
      width:72px;
      height:72px;
   }

  @media (max-width: 720px){
   .brand img{
     width:52px;
     height:52px;
   }
}

    .brandTitle{
      font-weight: 950;
      letter-spacing: .2px;
      line-height: 1.1;
    }
    .brandSub{
      font-size:12px;
      color: rgba(233,238,252,.70);
      margin-top:2px;
    }
    .navRight{
      display:flex; align-items:center; gap:10px; flex-wrap:wrap; justify-content:flex-end;
    }

    .badge{
      display:inline-flex; align-items:center; gap:8px;
      padding: 7px 12px;
      border-radius: 999px;
      background: rgba(255,183,3,.16);
      border: 1px solid rgba(255,183,3,.30);
      color: #ffd166;
      font-weight: 900;
      letter-spacing: .5px;
      text-transform: uppercase;
      font-size: 12px;
      user-select:none;
    }

    /* Cards */
    .box{
      border: 1px solid var(--border);
      border-radius: var(--r22);
      padding: 16px;
      margin: 14px 0;
      background: linear-gradient(180deg, rgba(255,255,255,.09), rgba(255,255,255,.04));
      box-shadow: var(--shadow);
      position: relative;
      overflow:hidden;
    }
    .box::before{
      content:"";
      position:absolute; inset:-1px;
      background:
        radial-gradient(600px 240px at 10% 0%, rgba(255,77,109,.10), transparent 55%),
        radial-gradient(700px 250px at 100% 10%, rgba(255,183,3,.08), transparent 55%);
      pointer-events:none;
    }
    .box > *{position:relative}

    .boxTitleRow{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px; margin-bottom: 10px;
    }
    h2,h3{margin:0}
    h3{font-size: 16px}
    .chip{
      display:inline-flex; align-items:center; gap:8px;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.07);
      font-weight: 850;
      font-size: 12px;
      user-select:none;
    }

    .grid2{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    .grid3{display:grid; grid-template-columns:repeat(3,1fr); gap:12px}

    /* Inputs */
    label{display:block; margin-bottom:6px}
    select,textarea,input{
      width:100%;
      padding:12px 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--text);
      outline:none;
    }
     select {
      background-color: rgba(15, 20, 40, 0.95);
      color: var(--text)
    }

    select option {
      background-color: #0b1220;
      color: #e9eefc
    }

    select option:hover,
    select option:checked {
      background-color: #1a2340;
      color: #ffffff
    }
    textarea{min-height:150px; resize: vertical}
    select:focus,textarea:focus,input:focus{
      border-color: rgba(255,77,109,.55);
      box-shadow: 0 0 0 4px rgba(255,77,109,.12);
    }

    /* Buttons */
    .btnRow{display:flex; gap:10px; margin-top:10px; flex-wrap:wrap}
    button{
      padding: 12px 14px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.10);
      cursor:pointer;
      background: linear-gradient(135deg, var(--primary), var(--primary2));
      color:white;
      font-weight: 950;
      letter-spacing:.2px;
      transition: transform .08s ease, opacity .15s ease, box-shadow .2s ease, filter .2s ease;
      box-shadow: 0 12px 26px rgba(255,46,85,.16);
    }
    button:hover{opacity:.97; filter: saturate(1.05)}
    button:active{transform: scale(.98)}
    button[disabled]{opacity:.45; cursor:not-allowed; box-shadow:none}

    .secondaryBtn{
      background: rgba(255,255,255,.07);
      border: 1px solid rgba(255,255,255,.16);
      box-shadow:none;
      color: rgba(233,238,252,.92);
    }

    /* Tags */
    .tag{
      display:inline-flex;
      align-items:center;
      gap:8px;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.10);
      border-radius:999px;
      padding:6px 10px;
      margin:4px 6px 0 0;
      font-size: 13px;
    }
    .tag::before{
      content:"‚Ä¢";
      color: rgba(255,183,3,.9);
      font-weight: 900;
    }

    /* Risk */
    .riskRow{display:flex; align-items:center; justify-content:space-between; gap:12px; margin-top:12px}
    .riskBadge{
      padding: 9px 12px;
      border-radius: 999px;
      font-weight: 950;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.08);
      display:inline-flex; align-items:center; gap:8px;
      user-select:none;
      white-space:nowrap;
    }
    .dot{
      width:10px;height:10px;border-radius:99px;background:rgba(255,255,255,.3);
      box-shadow: 0 0 0 4px rgba(255,255,255,.06);
    }

    .bar{
      width:100%;
      height: 10px;
      border-radius:999px;
      background: rgba(255,255,255,.08);
      overflow:hidden;
      border: 1px solid rgba(255,255,255,.10);
    }
    .bar > div{
      height:100%;
      width:0%;
      border-radius:999px;
      background: linear-gradient(90deg, var(--good), var(--mid), var(--bad));
      transition: width .35s ease;
    }

    /* Panels */
    .panel{
      background: rgba(0,0,0,.18);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 18px;
      padding: 12px;
      margin-top: 10px;
    }
    .panel h4{
      margin: 0 0 8px;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: .7px;
      color: rgba(233,238,252,.82);
    }
    .list{margin:0; padding-left: 18px}
    .list li{margin: 7px 0; color: rgba(233,238,252,.94)}
    .mono{
      white-space:pre-wrap;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 13px;
      line-height:1.5;
    }

    /* Email row */
    .emailRow{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .emailRow input{flex:1; min-width:220px}

    /* Pricing (kept but no prices) */
    .plan{
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      border-radius: 20px;
      padding: 14px;
      box-shadow: var(--shadowSoft);
      position:relative;
      overflow:hidden;
      min-height: 180px;
    }
    .plan::before{
      content:"";
      position:absolute; inset:-1px;
      background: radial-gradient(600px 240px at 20% 0%, rgba(255,77,109,.10), transparent 60%);
      pointer-events:none;
    }
    .plan > *{position:relative}
    .planTop{
      display:flex; align-items:flex-start; justify-content:space-between; gap:10px;
      margin-bottom: 8px;
    }
    .planName{font-weight:950}
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.07);
      font-size: 12px;
      font-weight: 850;
      user-select:none;
    }
    .plan ul{margin:10px 0 0; padding-left:18px}
    .plan li{margin:7px 0; color: rgba(233,238,252,.92)}
    .planCTA{margin-top: 12px; display:flex; gap:10px; flex-wrap:wrap}

    .highlight{
      border-color: rgba(255,183,3,.32);
      background: rgba(255,183,3,.08);
    }

    /* Toast */
    .toast{
      position: fixed;
      bottom: 16px;
      left: 50%;
      transform: translateX(-50%);
      width: min(700px, calc(100% - 22px));
      background: rgba(0,0,0,.55);
      border: 1px solid rgba(255,255,255,.12);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border-radius: 18px;
      padding: 12px 14px;
      box-shadow: var(--shadow);
      display:none;
      z-index: 100;
    }
    .toastRow{display:flex; align-items:flex-start; justify-content:space-between; gap:12px}
    .toastMsg{color: rgba(233,238,252,.95); line-height:1.4}
    .toastClose{
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.12);
      box-shadow:none;
      padding: 10px 12px;
      border-radius: 14px;
      font-weight: 900;
    }

    footer{
      margin-top: 18px;
      text-align:center;
      color: rgba(233,238,252,.62);
      font-size: 12px;
    }

    @media (max-width: 860px){
      .grid3{grid-template-columns:1fr}
    }
    @media (max-width: 720px){
      .grid2{grid-template-columns:1fr}
      .brand{min-width: unset}
      .navRight{width:100%; justify-content:flex-start}
    }
  </style>
</head>

<body>

  <!-- Sticky Nav -->
  <div class="nav">
    <div class="navInner">
      <div class="brand">
        <img src="logo.png" alt="Logo" />
        <div>
          <div class="brandTitle">üîê Anti-arnaque t√©l√©phonique</div>
          <div class="brandSub">Teste un appel en 10 secondes ‚Äî sans envoyer tes donn√©es.</div>
        </div>
      </div>

      <div class="navRight">
        <span class="badge">TEST</span>
        <button class="secondaryBtn" id="demoQuickBtn" type="button">‚ö° Exemple</button>
        <!-- PRICING NAV REMOVED -->
      </div>
    </div>
  </div>

  <div class="wrap">

    <div class="box">
      <div class="boxTitleRow">
        <h3>‚ö° Comment √ßa marche</h3>
        <span class="chip">Rapide & priv√©</span>
      </div>
      <p class="muted" style="margin:0">
        ‚ö†Ô∏è Un site ne peut pas se brancher √† l‚Äôaudio ‚Äúinterne‚Äù d‚Äôun appel.
        Pour tester : <b>colle le texte</b> (ou utilise le micro + appel en haut-parleur).
      </p>
      <p class="tiny" style="margin:10px 0 0">
        Astuce : si quelqu‚Äôun demande un <b>code SMS</b>, ton <b>mot de passe</b>, ou te met la pression (‚Äúne raccroche pas‚Äù), c‚Äôest tr√®s souvent une arnaque.
      </p>
    </div>

    <div class="box">
      <div class="grid2">
        <div>
          <label><b>Th√®me</b></label>
          <select id="theme">
            <option value="general">G√©n√©ral</option>
            <option value="banque">Banque</option>
            <option value="livraison">Livraison</option>
            <option value="gouvernement">Gouvernement / Immigration / Police</option>
          </select>
        </div>

        <div>
          <label><b>Mode</b></label>
          <div class="btnRow" style="margin-top:0">
            <button id="listenBtn" type="button">üéôÔ∏è √âcouter</button>
            <button id="stopBtn" disabled class="secondaryBtn" type="button">üõë Stop</button>
          </div>
          <div id="status" class="muted" style="margin-top:8px"></div>
        </div>
      </div>
    </div>

    <div class="box">
      <div class="boxTitleRow">
        <h3>üìù Texte de l‚Äôappel</h3>
        <span class="chip">Copie/colle</span>
      </div>

      <label class="muted" style="margin:0 0 8px">
        Colle ce que la personne dit (ou active le micro).
      </label>

      <textarea id="text" placeholder="Ex: Bonjour je suis du service s√©curit√©. Votre compte est bloqu√©. On a juste besoin du chiffre envoy√© sur ton cell. Ne raccrochez pas."></textarea>

      <div class="btnRow">
        <button id="analyzeBtn" type="button">Analyser mon appel</button>
        <button id="clearBtn" class="secondaryBtn" type="button">Effacer</button>
        <button id="demoBtn" class="secondaryBtn" type="button">Mettre un exemple</button>
      </div>

      <div class="tiny" style="margin-top:10px">
        Conseil : si le ton est pressant, raccroche. Ensuite seulement, v√©rifie via un num√©ro officiel.
      </div>
    </div>
    
    <!-- Signals -->
    <div class="box">
      <div class="boxTitleRow">
        <h3>üß© Signaux suspects d√©tect√©s</h3>
        <span class="chip">Auto-analyse</span>
      </div>

      <div id="hits">-</div>

      <div class="riskRow">
        <div class="riskBadge" id="riskBadge">
          <span class="dot" id="riskDot"></span>
          Risque : <span id="risk">-</span>
        </div>

        <div style="flex:1">
          <div class="bar"><div id="scoreFill"></div></div>
          <div class="muted" style="font-size:12px;margin-top:6px">
            Score = indicateur (pas une certitude). Reste prudent.
          </div>
        </div>
      </div>
    </div>

    <!-- Coaching -->
    <div class="box">
      <div class="boxTitleRow">
        <h3>üß† Coaching (quoi comprendre + quoi r√©pondre)</h3>
        <span class="chip">Guid√©</span>
      </div>

      <div class="panel">
        <h4>R√©sum√©</h4>
        <div id="sum1" class="mono">-</div>
      </div>

      <div class="panel">
        <h4>Pourquoi c‚Äôest dangereux</h4>
        <div id="sum2" class="mono">-</div>
      </div>

      <div class="panel">
        <h4>‚úÖ R√©ponses √† dire (courtes et fermes)</h4>
        <ul id="sayList" class="list"></ul>
      </div>

      <div class="panel">
        <h4>‚ùì Questions √† poser (pour casser l‚Äôarnaque)</h4>
        <ul id="askList" class="list"></ul>
      </div>
    </div>

    <!-- Actions -->
    <div class="box">
      <div class="boxTitleRow">
        <h3>üõ°Ô∏è Actions s√ªres recommand√©es</h3>
        <span class="chip">√Ä faire maintenant</span>
      </div>

      <div class="panel">
        <div id="action" class="mono">-</div>
      </div>

      <div class="tiny" style="margin-top:10px">
        Ce test est un outil d‚Äôaide. En cas de doute, raccroche et contacte l‚Äôorganisme via son num√©ro officiel.
      </div>
    </div>

    <footer>
      ¬© <span id="year"></span> Anti-arnaque ‚Äî Prototype. Ne partage jamais tes codes SMS, mots de passe ou infos bancaires.
    </footer>

  </div>

  <!-- Toast -->
  <div class="toast" id="toast">
    <div class="toastRow">
      <div class="toastMsg" id="toastMsg">-</div>
      <button class="toastClose" id="toastClose" type="button">OK</button>
    </div>
  </div>

<script>
/* =========================
   0) Toast utils (remplace alert)
========================= */
const toastEl = document.getElementById("toast");
const toastMsgEl = document.getElementById("toastMsg");
const toastCloseEl = document.getElementById("toastClose");

function toast(msg){
  toastMsgEl.textContent = msg;
  toastEl.style.display = "block";
  clearTimeout(window.__toastTimer);
  window.__toastTimer = setTimeout(() => (toastEl.style.display="none"), 4500);
}
toastCloseEl.onclick = () => toastEl.style.display="none";

/* ===== 1) ‚ÄúBase de connaissance‚Äù (r√®gles) ===== */
const THEMES = {
  general: {
    redflags: [
      "urgent", "imm√©diatement", "dernier avis", "tout de suite",
      "compte bloqu√©", "compte bloque", "gel√©", "gele",
      "ne raccrochez pas", "ne raccroche pas", "restez en ligne",
      "police", "immigration", "gouvernement",
      "carte-cadeau", "carte cadeau", "gift card", "crypto", "bitcoin",
      "anydesk", "teamviewer", "code sms", "otp", "2fa", "nip", "pin", "cvv", "num√©ro de carte", "numero de carte",
      "clique", "lien", "url", "site", "telecharge", "installe", "application", "support technique", "microsoft"
    ],
    say: [
      "Je ne traite rien sous pression.",
      "Je ne donne jamais de code SMS/OTP/NIP/CVV au t√©l√©phone.",
      "Je vais raccrocher et rappeler via le num√©ro officiel."
    ],
    ask: [
      "Quel est votre nom complet et votre extension ?",
      "Quel est le num√©ro de dossier / r√©f√©rence ?",
      "Pouvez-vous me l‚Äôenvoyer via mon compte officiel / courrier officiel ?"
    ]
  },
  banque: {
    redflags: ["code sms", "otp", "2fa", "nip", "pin", "cvv", "compte bloqu√©", "compte bloque", "urgent", "virement", "fraude", "transaction", "paiement"],
    say: [
      "Je ne donne jamais de code SMS/OTP/NIP/CVV au t√©l√©phone.",
      "Je raccroche et je rappelle la banque via le num√©ro officiel (site / carte).",
      "Je vais v√©rifier dans mon compte officiel. Merci."
    ],
    ask: [
      "Quel est le num√©ro de r√©f√©rence de l‚Äôappel ?",
      "Quel est votre nom et votre extension ?",
      "Quel est le nom exact de la banque et le d√©partement ?",
      "Je rappelle via le num√©ro officiel, notez-le dans mon dossier."
    ]
  },
  livraison: {
    redflags: ["colis", "douane", "frais", "payer", "lien", "cliquer", "urgent", "dernier avis", "carte", "compte bloqu√©", "adresse", "saisie", "verification"],
    say: [
      "Je ne clique sur aucun lien re√ßu par SMS pendant un appel.",
      "Je vais v√©rifier directement sur le site officiel du transporteur.",
      "Je ne paye rien au t√©l√©phone. Je v√©rifie d‚Äôabord."
    ],
    ask: [
      "Quel est le num√©ro de suivi officiel ?",
      "Quel est le nom exact du transporteur ?",
      "Donnez-moi l‚ÄôURL officielle, je la taperai moi-m√™me.",
      "Je v√©rifie sur le site officiel et je vous recontacte."
    ]
  },
  gouvernement: {
    redflags: ["police", "immigration", "gouvernement", "arrestation", "mandat", "amende", "urgence", "imm√©diatement", "ne raccrochez pas", "bitcoin", "crypto", "carte-cadeau", "paiement", "penalite"],
    say: [
      "Je ne r√®gle rien par t√©l√©phone sous menace.",
      "Je raccroche et je contacte l‚Äôorganisme via son num√©ro officiel.",
      "Envoyez-moi un avis officiel par courrier."
    ],
    ask: [
      "Quel service exact et quel identifiant d‚Äôagent ?",
      "Quel est le num√©ro de dossier officiel ?",
      "Quelle adresse de bureau / site officiel ?",
      "Envoyez-moi une convocation/avis officiel."
    ]
  }
};

// D√©tections ‚Äúintelligentes‚Äù (variantes)
const REGEX_RULES = [
  { re: /\b(code|codes)\b.*\b(sms|otp|2fa)\b/i, label: "Demande de code (SMS/OTP/2FA)" },
  { re: /\b(nip|pin|cvv)\b/i, label: "Demande d‚Äôinfos bancaires sensibles (NIP/PIN/CVV)" },
  { re: /\b(ne\s+raccroch|restez\s+en\s+ligne)\b/i, label: "Pression: ne pas raccrocher" },
  { re: /\b(compte)\b.*\b(bloqu|gele)\b/i, label: "Menace: compte bloqu√©/gel√©" },
  { re: /\b(anydesk|teamviewer)\b/i, label: "Acc√®s √† distance (AnyDesk/TeamViewer)" },
  { re: /\b(carte.?cadeau|gift\s*card|crypto|bitcoin)\b/i, label: "Paiement suspect (cartes-cadeaux/crypto)" },
  { re: /\b(clique|lien|url)\b/i, label: "Lien suspect (clique / URL)" },
  { re: /\b(installe|telecharge|t[e√©]l[e√©]charge)\b/i, label: "Demande d‚Äôinstallation (t√©l√©chargement/app)" },
  {
    re: /\b(juste|seulement|uniquement)\b.*\b(chiffre|code|numero|num√©ro)\b.*\b(cell|telephone|t[e√©]l[e√©]phone|sms|texto|message)\b/i,
    label: "Demande d√©guis√©e de code (chiffre/code sur t√©l√©phone)"
  },
  {
    re: /\b(pas\s+besoin|on\s+n['‚Äô]a\s+pas\s+besoin)\b.*\b(code|mot\s+de\s+passe|password)\b.*\b(donne|envoy|dicte|dis)\b.*\b(code|chiffre|sms|otp|2fa)\b/i,
    label: "Manipulation: minimise le risque puis demande un code"
  }
];

/* ===== Intentions (ce que l'arnaqueur veut vraiment) ===== */
const INTENT_RULES = [
  {
    key: "otp",
    label: "Vol de code de v√©rification (OTP/SMS/2FA)",
    want: ["Le code re√ßu par SMS (souvent 4 √† 6 chiffres)", "Une validation 2FA/OTP"],
    theyMayHave: ["Ton num√©ro de t√©l√©phone", "Parfois ton nom (si fuite de donn√©es)"],
    why: "Avec ton code, ils peuvent se connecter √† ton compte ou valider une transaction.",
    say: [
      "Je ne partage jamais un code re√ßu par SMS. Jamais.",
      "Je raccroche et je rappelle via le num√©ro officiel."
    ],
    ask: [
      "Quel est le num√©ro de dossier officiel ?",
      "Je veux un email officiel via mon compte (pas au t√©l√©phone)."
    ],
    re: [
      /\b(code|chiffre|numero|num√©ro)\b.*\b(sms|texto|message|cell|t[e√©]l[e√©]phone)\b/i,
      /\b(otp|2fa|authentification|verification|v[e√©]rification)\b/i,
      /\b(juste|seulement|uniquement)\b.*\b(chiffre|code)\b/i
    ]
  },
  {
    key: "password",
    label: "Vol d‚Äôidentifiants (mot de passe / login)",
    want: ["Ton mot de passe", "Ton identifiant / email", "Acc√®s au compte"],
    theyMayHave: ["Ton email ou ton nom (souvent)", "Des infos partielles trouv√©es en ligne"],
    why: "Ils cherchent un acc√®s direct √† tes comptes.",
    say: [
      "Je ne donne jamais de mot de passe au t√©l√©phone.",
      "Je vais v√©rifier dans mon compte officiel et je vous rappelle."
    ],
    ask: [
      "Quel est votre nom complet et votre extension ?",
      "Quelle entreprise exactement ? Donnez-moi l‚ÄôURL officielle."
    ],
    re: [
      /\b(mot\s*de\s*passe|password|mdp)\b/i,
      /\b(identifiant|login|nom\s*d['‚Äô]utilisateur|username)\b/i
    ]
  },
  {
    key: "card",
    label: "Vol bancaire (carte / CVV / PIN / infos)",
    want: ["Num√©ro de carte", "CVV", "NIP/PIN", "Infos pour paiement ou virement"],
    theyMayHave: ["Ton nom", "Parfois les 4 derniers chiffres (si fuite)"],
    why: "Ils peuvent effectuer des achats, virements ou usurper ton identit√© bancaire.",
    say: [
      "Je ne communique jamais mon CVV/NIP/PIN.",
      "Je raccroche et j‚Äôappelle la banque via le num√©ro au dos de la carte."
    ],
    ask: [
      "Quel est le num√©ro de r√©f√©rence de l‚Äôappel ?",
      "Je rappelle via le num√©ro officiel, merci."
    ],
    re: [
      /\b(cvv|nip|pin)\b/i,
      /\b(num[e√©]ro\s*de\s*carte|carte)\b/i,
      /\b(virement|transfert|fraude|transaction)\b/i
    ]
  },
  {
    key: "remote",
    label: "Prise de contr√¥le (AnyDesk/TeamViewer)",
    want: ["Acc√©der √† ton t√©l√©phone/PC", "Voir ton √©cran", "Contr√¥ler l‚Äôappareil"],
    theyMayHave: ["Ta peur/pression", "Un faux pr√©texte de support"],
    why: "Ils prennent le contr√¥le pour voler des infos, installer quelque chose, ou valider des paiements.",
    say: [
      "Je n‚Äôinstalle aucun logiciel de contr√¥le √† distance.",
      "Je vais contacter le support officiel moi-m√™me."
    ],
    ask: [
      "Quel est le site officiel ? Je vais ouvrir un ticket moi-m√™me.",
      "Donnez-moi un num√©ro de dossier et je rappelle."
    ],
    re: [
      /\b(anydesk|teamviewer|prise\s*de\s*contr[o√¥]le|contr[o√¥]ler\s*mon\s*[e√©]cran)\b/i,
      /\b(installe|t[e√©]l[e√©]charge|telecharge|ouvre)\b.*\b(app|application|logiciel)\b/i
    ]
  },
  {
    key: "authority",
    label: "Menace / Autorit√© (police, immigration, gouvernement)",
    want: ["Te faire paniquer", "Obtenir paiement ou infos", "T‚Äôemp√™cher de v√©rifier"],
    theyMayHave: ["Ton num√©ro", "Ton nom parfois"],
    why: "La peur te pousse √† ob√©ir sans r√©fl√©chir.",
    say: [
      "Je ne r√®gle rien sous menace par t√©l√©phone.",
      "Envoyez-moi un avis officiel. Je raccroche."
    ],
    ask: [
      "Quel service exact et quel identifiant d‚Äôagent ?",
      "Quel est le num√©ro de dossier officiel ?"
    ],
    re: [
      /\b(police|immigration|gouvernement|arrestation|mandat|amende)\b/i,
      /\b(ne\s*raccroch|restez\s*en\s*ligne)\b/i
    ]
  },
  {
    key: "link",
    label: "Pi√®ge par lien (SMS/Email) + action urgente",
    want: ["Te faire cliquer", "Te faire entrer tes infos", "Installer quelque chose"],
    theyMayHave: ["Ton num√©ro (si SMS)", "Un message bien imit√©"],
    why: "Le lien t‚Äôemm√®ne vers un faux site qui vole tes infos.",
    say: [
      "Je ne clique sur aucun lien re√ßu par SMS pendant un appel.",
      "Je vais sur le site officiel moi-m√™me (tap√© √† la main)."
    ],
    ask: [
      "Quel est le num√©ro de suivi / r√©f√©rence ?",
      "Je v√©rifie sur le site officiel."
    ],
    re: [
      /\b(clique|lien|url|site)\b/i,
      /\b(urgent|dernier\s*avis|imm[e√©]diatement)\b/i
    ]
  }
];

function normalize(s){
  return (s||"")
    .toLowerCase()
    .replaceAll("√©","e").replaceAll("√®","e").replaceAll("√™","e")
    .replaceAll("√†","a").replaceAll("√ß","c")
    .replace(/[^a-z0-9\s]/g," ")
    .replace(/\s+/g," ")
    .trim();
}
function dedup(arr){
  const seen = new Set();
  const out = [];
  for (const x of arr){
    if (!seen.has(x)){ seen.add(x); out.push(x); }
  }
  return out;
}
function detectIntents(rawText){
  const found = [];
  for (const rule of INTENT_RULES){
    if (rule.re.some(rx => rx.test(rawText))) found.push(rule);
  }
  return found;
}
function analyze(text, themeKey){
  const cfg = THEMES[themeKey] || THEMES.general;
  const t = normalize(text);

  let hits = [];
  for (const w of cfg.redflags){
    const wn = normalize(w);
    if (wn && t.includes(wn)) hits.push(w);
  }
  for (const r of REGEX_RULES){
    if (r.re.test(text)) hits.push(r.label);
  }
  hits = dedup(hits);

  const intents = detectIntents(text);
  const score = Math.min(100, (hits.length * 15) + (intents.length * 20));
  const level = score >= 60 ? "√âLEV√â" : (score >= 30 ? "MOYEN" : "FAIBLE");
  const primary = intents[0] || null;

  const say2 = primary ? dedup([...primary.say, ...cfg.say]) : cfg.say;
  const ask2 = primary ? dedup([...primary.ask, ...cfg.ask]) : cfg.ask;

  const intentSummary = primary ? {
    title: primary.label,
    want: primary.want,
    have: primary.theyMayHave,
    why: primary.why
  } : {
    title: "Intention non d√©termin√©e (reste prudent)",
    want: ["Informations personnelles ou action rapide"],
    have: ["Ton num√©ro / nom peut-√™tre"],
    why: "Certaines arnaques utilisent des formulations vari√©es."
  };

  const action = [
    "1) Raccroche si tu sens la pression.",
    "2) Ne donne jamais: code SMS/OTP, NIP/PIN, CVV, mot de passe.",
    "3) Rappelle via le num√©ro officiel (site, carte, facture).",
    "4) Ne rappelle jamais le num√©ro entrant.",
    "5) Si doute: demande ‚ÄòJe vous rappelle plus tard‚Äô puis v√©rifie."
  ];

  return {level, score, hits, say: say2, ask: ask2, action, intentSummary, intents};
}

/* ===== 2) UI ===== */
const themeEl = document.getElementById("theme");
const textEl = document.getElementById("text");

const hitsEl = document.getElementById("hits");
const riskEl = document.getElementById("risk");
const riskBadgeEl = document.getElementById("riskBadge");
const scoreFillEl = document.getElementById("scoreFill");
const riskDotEl = document.getElementById("riskDot");

const sum1El = document.getElementById("sum1");
const sum2El = document.getElementById("sum2");
const sayListEl = document.getElementById("sayList");
const askListEl = document.getElementById("askList");
const actionEl = document.getElementById("action");

function setRiskStyle(level){
  if (level === "FAIBLE") {
    riskBadgeEl.style.background = "rgba(34,197,94,.14)";
    riskBadgeEl.style.borderColor = "rgba(34,197,94,.30)";
    riskDotEl.style.background = "rgba(34,197,94,.95)";
    riskDotEl.style.boxShadow = "0 0 0 4px rgba(34,197,94,.10)";
  } else if (level === "MOYEN") {
    riskBadgeEl.style.background = "rgba(245,158,11,.14)";
    riskBadgeEl.style.borderColor = "rgba(245,158,11,.30)";
    riskDotEl.style.background = "rgba(245,158,11,.95)";
    riskDotEl.style.boxShadow = "0 0 0 4px rgba(245,158,11,.10)";
  } else {
    riskBadgeEl.style.background = "rgba(239,68,68,.14)";
    riskBadgeEl.style.borderColor = "rgba(239,68,68,.30)";
    riskDotEl.style.background = "rgba(239,68,68,.95)";
    riskDotEl.style.boxShadow = "0 0 0 4px rgba(239,68,68,.10)";
  }
}

document.getElementById("analyzeBtn").onclick = () => {
  const txt = textEl.value.trim();
  if (!txt){
    toast("Colle/√©cris d‚Äôabord le texte de l‚Äôappel üôÇ");
    return;
  }

  const res = analyze(txt, themeEl.value);

  riskEl.textContent = `${res.level} (${res.score}/100)`;
  setRiskStyle(res.level);
  scoreFillEl.style.width = `${res.score}%`;

  if (!res.hits.length){
    hitsEl.textContent = "Aucun signal d√©tect√© (reste prudent).";
  } else {
    hitsEl.innerHTML = res.hits.map(x => `<span class="tag">${x}</span>`).join("");
  }

  sum1El.textContent =
    `‚Ä¢ Intention probable : ${res.intentSummary.title}\n` +
    `‚Ä¢ Ce qu‚Äôelle cherche √† obtenir :\n   - ${res.intentSummary.want.join("\n   - ")}\n` +
    `‚Ä¢ Ce qu‚Äôelle pourrait d√©j√† savoir :\n   - ${res.intentSummary.have.join("\n   - ")}`;

  sum2El.textContent = `‚Ä¢ ${res.intentSummary.why}`;

  sayListEl.innerHTML = res.say.map(x => `<li>${x}</li>`).join("");
  askListEl.innerHTML = res.ask.map(x => `<li>${x}</li>`).join("");
  actionEl.textContent = res.action.join("\n");

  document.getElementById("hits").scrollIntoView({behavior:"smooth", block:"center"});
};

document.getElementById("clearBtn").onclick = () => {
  textEl.value = "";
  hitsEl.textContent = "-";
  riskEl.textContent = "-";
  scoreFillEl.style.width = "0%";

  sum1El.textContent = "-";
  sum2El.textContent = "-";
  sayListEl.innerHTML = "";
  askListEl.innerHTML = "";

  actionEl.textContent = "-";
  toast("R√©initialis√© ‚úÖ");
};

document.getElementById("demoBtn").onclick = () => {
  themeEl.value = "banque";
  textEl.value = "Bonjour je suis du service s√©curit√© de votre banque. Votre compte est bloqu√©. On a juste besoin du chiffre envoy√© sur ton cell pour confirmer. Ne raccrochez pas.";
  toast("Exemple ajout√© ‚úÖ Clique sur ‚ÄúAnalyser mon appel‚Äù.");
};

document.getElementById("demoQuickBtn").onclick = () => {
  document.getElementById("demoBtn").click();
  window.scrollTo({top: 250, behavior:"smooth"});
};

/* ===== 3) Option ‚Äú√©couter‚Äù (si support√©) ===== */
let recognition = null;
const statusEl = document.getElementById("status");
const listenBtn = document.getElementById("listenBtn");
const stopBtn = document.getElementById("stopBtn");

function setListening(on){
  listenBtn.disabled = on;
  stopBtn.disabled = !on;
}

listenBtn.onclick = () => {
  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  if (!SR){
    toast("Transcription non support√©e ici. Essaie Chrome ou Edge.");
    return;
  }

  recognition = new SR();
  recognition.lang = "fr-FR";
  recognition.continuous = true;
  recognition.interimResults = true;

  statusEl.textContent = "√âcoute en cours‚Ä¶ (mets l‚Äôappel en haut-parleur si besoin)";
  setListening(true);

  let finalText = "";
  recognition.onresult = (event) => {
    let interim = "";
    for (let i = event.resultIndex; i < event.results.length; i++){
      const part = event.results[i][0].transcript;
      if (event.results[i].isFinal) finalText += part + " ";
      else interim += part;
    }
    const shown = (finalText + interim).trim();
    textEl.value = shown;

    if (shown.length > 20) document.getElementById("analyzeBtn").click();
  };

  recognition.onerror = (e) => {
    statusEl.textContent = "Erreur micro/transcription: " + e.error;
    setListening(false);
  };

  recognition.onend = () => {
    statusEl.textContent = "Arr√™t.";
    setListening(false);
  };

  recognition.start();
};

stopBtn.onclick = () => {
  if (recognition) recognition.stop();
  setListening(false);
  toast("Micro arr√™t√©.");
};

/* ===== 4) Collecte email (sans backend) ===== */
const FORMSPREE_URL = "https://formspree.io/f/TON_ID_ICI";

const emailEl = document.getElementById("email");
const joinBtn = document.getElementById("joinBtn");
const joinStatus = document.getElementById("joinStatus");
const privacyBtn = document.getElementById("privacyBtn");

privacyBtn.onclick = () => {
  toast(
    "Politique (r√©sum√©): On collecte uniquement ton email pour te recontacter. " +
    "Aucune transcription audio n‚Äôest envoy√©e automatiquement. Tu peux demander la suppression √† tout moment."
  );
};

joinBtn.onclick = async () => {
  const email = (emailEl.value || "").trim();
  if (!email || !email.includes("@")) {
    joinStatus.textContent = "Entre un email valide üôÇ";
    toast("Entre un email valide üôÇ");
    return;
  }

  joinBtn.disabled = true;
  joinStatus.textContent = "Envoi en cours‚Ä¶";

  try {
    const res = await fetch(FORMSPREE_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json", "Accept": "application/json" },
      body: JSON.stringify({
        email,
        source: "anti-arnaque-test",
        createdAt: new Date().toISOString()
      })
    });

    if (res.ok) {
      joinStatus.textContent = "‚úÖ Merci ! Tu es sur la liste. On te contacte bient√¥t.";
      toast("‚úÖ Merci ! Email enregistr√©.");
      emailEl.value = "";
    } else {
      joinStatus.textContent = "‚ö†Ô∏è Impossible d‚Äôenvoyer. R√©essaie plus tard.";
      toast("‚ö†Ô∏è Impossible d‚Äôenvoyer. R√©essaie plus tard.");
    }
  } catch (e) {
    joinStatus.textContent = "‚ö†Ô∏è Erreur r√©seau. V√©rifie ta connexion.";
    toast("‚ö†Ô∏è Erreur r√©seau. V√©rifie ta connexion.");
  } finally {
    joinBtn.disabled = false;
  }
};

/* ===== Pricing CTAs (NO PRICES) ===== */
function scrollToEmail(){
  document.getElementById("waitlist").scrollIntoView({behavior:"smooth", block:"center"});
  emailEl.focus();
}

document.getElementById("ctaTry").onclick = () => scrollToEmail();
document.getElementById("ctaPlus").onclick = () => scrollToEmail();
document.getElementById("ctaFamilyWaitlist").onclick = () => scrollToEmail();

document.getElementById("ctaPlusInfo").onclick = () =>
  toast("üîµ Plus : 5 scans/semaine + historique 30 jours + analyse plus d√©taill√©e.");

document.getElementById("ctaFamilyInfo").onclick = () =>
  toast("üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Famille : jusqu‚Äô√† 5 personnes + alertes & pr√©vention + support prioritaire.");

document.getElementById("year").textContent = new Date().getFullYear();
</script>

</body>
</html>




